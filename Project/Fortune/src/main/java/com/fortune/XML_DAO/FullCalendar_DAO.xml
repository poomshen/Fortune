<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mappier.dtd">
<mapper namespace="com.fortune.fullcalendar_DAO.IFullCalendar">



<!-- 일정(일반업무)등록 -1 -->
<insert id="insertSchedule">
<!-- schedule 테이블 insert -->
INSERT INTO schedule(SCHEDULE_NO, COLLABO_NO, SCHEDULE_START, SCHEDULE_END)
    VALUES((select nvl(max(schedule_no)+1,1) from schedule), #{collabo_no}, #{schedule_start}, #{schedule_end})
</insert>
<!-- 일정(일반업무)등록 -2 -->
<insert id="insertWork">
<!-- work 테이블 insert -->
INSERT INTO work(SCHEDULE_NO, WORK_TITLE, WORK_TEXT)
    VALUES((select max(schedule_no) from schedule), #{work_title}, #{work_text})
</insert>
<!-- 일정(일반업무)등록-3 // Work_users insert작업 -->
<insert id="insertWork_Users">
insert into work_users(user_id, schedule_no) values(#{user_id}, #{schedule_no})
</insert>
<!-- 일정(일반업무)등록-4 // 등록 후 schedule_no select작업 -->
<select id="selectScheduleno" resultType="com.fortune.Table_DTO.Schedule_DTO">
	select nvl(max(schedule_no)+1,1) as"schedule_no" from schedule
</select>




<!-- 모든 일정(일반업무) select -1 -->
<select id="selectSWList" resultType="com.fortune.function_DTO.Schedule_Work_DTO">
	SELECT S.SCHEDULE_NO, SCHEDULE_START, SCHEDULE_END, WORK_TITLE, WORK_TEXT FROM 
	SCHEDULE S JOIN WORK W 
	ON S.SCHEDULE_NO = W.SCHEDULE_NO 
	WHERE S.COLLABO_NO = #{collabo_no}
	ORDER BY SCHEDULE_START
</select>

<!-- 일정마다 참가자 select -2 -->
<select id="selectWUList" resultType="com.fortune.Table_DTO.Work_Users_DTO">
	select user_id, wu.schedule_no from
	work_users wu join work w
	on wu.SCHEDULE_NO = w.SCHEDULE_NO
	join schedule s
	on w.schedule_no = s.schedule_no
	where s.collabo_no = #{collabo_no}
</select>




<!-- 선택한 일정 select -->
<select id="selectClick" resultType="com.fortune.function_DTO.Schedule_Work_DTO">
	SELECT S.SCHEDULE_NO, SCHEDULE_START, SCHEDULE_END, WORK_TITLE, WORK_TEXT FROM 
	SCHEDULE S JOIN WORK W 
	ON S.SCHEDULE_NO = W.SCHEDULE_NO 
	WHERE S.COLLABO_NO = 1 AND S.SCHEDULE_NO = #{id}
</select>



<!-- 일정 delete 작업 -1 -->
<delete id="deleteWork">
	delete from work where schedule_no = #{id}
</delete>
<!-- 일정 delete 작업 -2 -->
<delete id="deleteSchedule">
	delete from schedule where schedule_no = #{id}
</delete>
<!-- 일정 delete 작업 -3 -->
<delete id="deleteWork_Users">
	delete from work_users where schedule_no =#{id}
</delete>




<!-- 일정 update -->
<update id="updateWork">
	UPDATE WORK SET WORK_TITLE = #{work_title}, WORK_TEXT = #{work_text}
	WHERE SCHEDULE_NO = #{schedule_no}
</update>




<!-- 일정 dragupdate -->
<update id="updateSchedule">
	UPDATE schedule SET schedule_start = #{schedule_start}, schedule_end = #{schedule_end}
	WHERE SCHEDULE_NO = #{schedule_no}
</update>




<!-- 일정 상세보기의 comment 불러오기 -->
<select id="selectComment" resultType="com.fortune.Table_DTO.Work_Comment_DTO">
	select * from work_comment where schedule_no = #{id}
</select>



</mapper>