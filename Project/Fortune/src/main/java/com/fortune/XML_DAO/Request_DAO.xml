<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fortune.request_DAO.ProDao">


<select id="requestCount" resultType="Integer" >
			SELECT COUNT(*) CNT 
			FROM collabo_req
			WHERE ${param1} like '%${param2}%' 
	</select>

<select id="getRequest" resultType="com.fortune.Table_DTO.Request_DTO" >
		SELECT * FROM (SELECT ROWNUM NUM, N.* FROM 
			( SELECT * FROM collabo_req WHERE ${param2} 
			LIKE '%${param3}%' ORDER BY collabo_req_date DESC ) N ) 
			WHERE NUM BETWEEN 1 + (${param1} - 1) * 50 AND 50 + (${param1} - 1) * 50 
</select>


<insert id="insert">
	
	
	<selectKey order="BEFORE" keyProperty="collabo_req_index" resultType="String">
		SELECT MAX(TO_NUMBER(collabo_req_index))+1 FROM collabo_req
	</selectKey>
	<choose>
	<when test="collabo_req_index == null">
		Insert into collabo_req(collabo_req_index,collabo_req_no,user_ID, collabo_req_title,
							  collabo_req_text, collabo_req_date, collabo_req_ID, collabo_req_state)
		VALUES(1,1, #{user_ID}, #{collabo_req_title}, #{collabo_req_text}, SYSDATE ,'sung@gmail.com', #{collabo_req_state})
	</when>
	
	<otherwise>
	Insert into collabo_req(collabo_req_index,collabo_req_no,user_ID, collabo_req_title,
							  collabo_req_text, collabo_req_date, collabo_req_ID, collabo_req_state)
		VALUES(#{collabo_req_index},1, #{user_ID}, #{collabo_req_title}, #{collabo_req_text}, SYSDATE ,'sung@gmail.com', #{collabo_req_state})
	</otherwise>
	</choose>
	
</insert>



	<delete id="delete">
	
		DELETE collabo_req WHERE collabo_req_index=#{collabo_req_index}
		
	</delete>
	
	
	<update id="accept" >
	UPDATE collabo_req SET
	 collabo_req_state='수락'
	 WHERE collabo_req_index=#{collabo_req_index}
	</update>
	
	<update id="refuse" >
	UPDATE collabo_req SET
	 collabo_req_state='거절'
	 WHERE collabo_req_index=#{collabo_req_index}
	
	</update>
	

	<select id="getProDto" resultType="com.fortune.Table_DTO.Request_DTO">
	<!-- 
			public Notice getNotice(String seq) 
			parameter 1개 생략 : 사용  parameter 이름 :seq
			param1 은 안되요 (x)
	-->
	SELECT * FROM collabo_req WHERE collabo_req_index= #{collabo_req_index}
	</select>	
	
	
	<insert id="insertResponse" >
	
	
<!-- 	<selectKey order="BEFORE" keyProperty="collabo_no" resultType="String">
		SELECT MAX(TO_NUMBER(collabo_no))+1 FROM collabo
	</selectKey> -->
	<choose>
	<when test="collabo_no == null">
		Insert into collabo(collabo_no,collabo_req_index,collabo_req_no,user_ID,
							  collabo_start, collabo_end, collabo_state)
		VALUES(collabo_seq.nextval,#{collabo_req_index},#{collabo_req_no}, #{user_ID}, #{collabo_start}, #{collabo_end}, #{collabo_state})
	</when>
	
	<otherwise>
		Insert into collabo(collabo_no,collabo_req_index,collabo_req_no,user_ID,
							  collabo_start, collabo_end, collabo_state)
		VALUES(collabo_seq.nextval,#{collabo_req_index},#{collabo_req_no}, #{user_ID}, #{collabo_start}, #{collabo_end}, #{collabo_state})
	</otherwise>
	</choose>
	
</insert>
	
	
	
	
</mapper>