<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fortune.chart_DAO.IChart">
<!-- chart 체크 -->
 <select id="selectChartAll" resultType="com.fortune.Table_DTO.Chart_Data_DTO">
 
select cdl.chart_date,cdl.chart_progress,cdl.chart_total_date,cr.collabo_req_title,cdl.collabo_no from 
(select cd.chart_date,cd.chart_progress,cd.chart_total_date,cd.collabo_no,cl.collabo_req_index from (select m.chart_date,c.collabo_no,c.chart_progress,c.chart_total_date,c.chart_seq from CHART_DATA c
join (select max(chart_date)as chart_date,collabo_no from chart_data group by collabo_no)m 
on c.chart_date=m.chart_date where c.collabo_no=m.collabo_no) cd join collabo cl on cd.collabo_no = cl.collabo_no) cdl join collabo_req cr on cdl.collabo_req_index = cr.collabo_req_index 

 </select>
 
<!-- chart  추가 -->
 <select id="selectChart" resultType="com.fortune.Table_DTO.Chart_Data_DTO">
  select chart_date,collabo_no,chart_progress,chart_total_date,chart_seq from chart_data where collabo_no=#{collabo_no} order by chart_date  
</select>

<select id="selectSumSal" resultType="com.fortune.function_DTO.Pie_Data_DTO">
select a.sum_sal,b.dept_name from 
(select * from (select sum(collabo_sal)as sum_sal,collabo_req_id from collabo group by collabo_req_id) c join users u on c.collabo_req_id=u.user_id)
a join (select d.dept_name,u.user_id from users u join dept d on u.dept_no=d.dept_no) b on a.user_id=b.user_id
</select>


 </mapper>
 
 
 